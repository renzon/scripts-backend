{% extends 'categorias/categoria_base.html' %}
{% block js %}
  <script type="application/javascript">

    $(document).ready(function () {
      var $wellForm = $('#well-form');
      {#      $wellForm.hide();#}
      var $formCategoria = $('#form-categoria');
      var groups = {'nome': $('#nome-group'), 'codigo': $('#codigo-group')};
      var helpBlocks = {'nome': $('#nome-help'), 'codigo': $('#codigo-help')};
      var $formInputs = $formCategoria.find('input');
      var $listaVisualCategorias = $('#lista-categorias');
      var id = 1;

      function mostrarErros(erros) {
        for (var propriedade in erros) {
          var msgDeErro = erros[propriedade];
          groups[propriedade].addClass('has-error');
          helpBlocks[propriedade].text(msgDeErro);
        }
      }

      function limparErros() {
        for (var p in groups) {
          var $g = groups[p];
          $g.removeClass('has-error');
          helpBlocks[p].empty();
        }
      }



      function mostrarCategoria(categoria) {
        var linha = '<li>Id: ';
        linha += categoria.id;
        linha += ', Criação: ';
        linha += categoria.creation;
        linha += ', Nome: ';
        linha += categoria.nome;
        linha += ', Código: ';
        linha += categoria.codigo;
        linha += '<button class="btn btn-danger">';
        linha += '<i class="glyphicon glyphicon-trash"></i></<button>';
        linha += '</li>';
        var $linhaNoDom=$(linha);
        $linhaNoDom.find('.btn-danger').click(function () {
          console.log(categoria.id);
          $linhaNoDom.remove();
        });
        $listaVisualCategorias.append($linhaNoDom);


      }

      $formCategoria.submit(function (evento) {
        evento.preventDefault();
        limparErros();

        var categoria = {};
        $formInputs.each(function (i, input) {
          var $input = $(input);
          categoria[$input.attr('name')] = $input.val();
        });

        var erros = {};

        var flagErro = false;
        for (var p in categoria) {
          if (categoria[p] === '') {
            flagErro = true;
            erros[p] = 'Campo obrigatório';
          }
        }
        if (flagErro) {
          mostrarErros(erros);
        } else {
          $formCategoria[0].reset();
          categoria.id = id;
          id++;
          categoria.creation = '03/16/2016 07:00:11';
          mostrarCategoria(categoria);
        }


      });

      {#      $wellForm.hide();#}

      $('#botao-mostrar-form').click(function () {
        $wellForm.slideToggle();
      });
    });
  </script>

{% endblock %}
{% block body %}
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>Crud com Jquery </h1>
        <button id="botao-mostrar-form" class="btn btn-success">Criar Nova Categoria</button>
        <div id="well-form" class="well">
          <h1 class="text-center">Categoria Form</h1>

          <form id="form-categoria" action="#" role="form">

            <div id='nome-group' class="form-group">

              <label for="nomeInput" class="control-label">Nome </label>
              <input id="nomeInput" type="text" class="form-control" name="nome" value="asdf">
              <span id="nome-help" class="help-block"></span>
            </div>
            <div id="codigo-group" class="form-group ">
              <label for="codigoInput" class="control-label">Codigo </label>
              <input id="codigoInput" type="text" class="form-control" name="codigo" value="sdfsdfsd">
              <span id="codigo-help" class="help-block"></span>
            </div>

            <button type="submit" class="btn btn-success">Salvar</button>
          </form>
        </div>
        <h2>Lista de Categorias</h2>
        <ol id="lista-categorias">

        </ol>
      </div>
    </div>
  </div>
{% endblock %}